{"ast":null,"code":"import { switchMap, take } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/categories.service\";\nimport * as i2 from \"../services/product.service\";\nimport * as i3 from \"../services/cart.service\";\nimport * as i4 from \"../services/authentication.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"./categories/categories.component\";\nimport * as i7 from \"./products/products.component\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"./cart/cart.component\";\nimport * as i10 from \"./product-form/product-form.component\";\n\nfunction StoreComponent_app_cart_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-cart\", 6);\n    i0.ɵɵlistener(\"removeItem\", function StoreComponent_app_cart_8_Template_app_cart_removeItem_0_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.removeFromCart($event);\n    });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"user\", i0.ɵɵpipeBind1(1, 3, ctx_r0.user$))(\"totalPrice\", i0.ɵɵpipeBind1(2, 5, ctx_r0.totalPrice$))(\"cart\", i0.ɵɵpipeBind1(3, 7, ctx_r0.cart$));\n  }\n}\n\nfunction StoreComponent_app_product_form_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-product-form\", 7);\n  }\n}\n\nexport class StoreComponent {\n  constructor(categoriesService, productService, cartService, authService, activeRoute) {\n    this.categoriesService = categoriesService;\n    this.productService = productService;\n    this.cartService = cartService;\n    this.authService = authService;\n    this.activeRoute = activeRoute;\n    this.products$ = this.productService.products$;\n    this.categories$ = this.categoriesService.categories$;\n    this.cart$ = this.cartService.cart$;\n    this.totalPrice$ = this.cartService.totalPrice$;\n    this.user$ = this.authService.user$;\n  } // ngOnDestroy(): void {\n  //   throw new Error('Method not implemented.');\n  // }\n\n\n  ngOnInit() {\n    this.categoriesService.getCategories().pipe(take(1)).subscribe();\n    this.categoriesService.currentCategory$.pipe(switchMap(category => {\n      return this.productService.getProductsBySelectedCategory(category === null || category === void 0 ? void 0 : category.id);\n    })).subscribe();\n  }\n\n  onCategorySelected(category) {\n    this.categoriesService.setCurrentCategory(category);\n  }\n\n  addToCart(product) {\n    var _a, _b;\n\n    console.log((_a = this.cartService.cart) === null || _a === void 0 ? void 0 : _a.products);\n    console.log(product);\n\n    const _product = (_b = this.cartService.cart) === null || _b === void 0 ? void 0 : _b.products.find(p => {\n      var _a;\n\n      return ((_a = p.product) === null || _a === void 0 ? void 0 : _a.id) == product.id;\n    });\n\n    console.log(_product);\n\n    if (_product) {\n      _product.quantity += 1;\n      this.cartService.updateCartItemQty(_product).pipe(switchMap(() => {\n        var _a;\n\n        return this.cartService.getCart((_a = this.authService.user) === null || _a === void 0 ? void 0 : _a.id);\n      })).subscribe();\n    } else {\n      this.cartService.addToCart(product).pipe(take(1), switchMap(() => {\n        var _a;\n\n        return this.cartService.getCart((_a = this.authService.user) === null || _a === void 0 ? void 0 : _a.id);\n      })).subscribe();\n    }\n  }\n\n  removeFromCart(product) {\n    this.cartService.removeFromCart(product).pipe(take(1)).subscribe();\n  }\n\n}\n\nStoreComponent.ɵfac = function StoreComponent_Factory(t) {\n  return new (t || StoreComponent)(i0.ɵɵdirectiveInject(i1.CategoriesService), i0.ɵɵdirectiveInject(i2.ProductService), i0.ɵɵdirectiveInject(i3.CartService), i0.ɵɵdirectiveInject(i4.AuthenticationService), i0.ɵɵdirectiveInject(i5.ActivatedRoute));\n};\n\nStoreComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: StoreComponent,\n  selectors: [[\"app-store\"]],\n  decls: 12,\n  vars: 18,\n  consts: [[1, \"container\"], [1, \"main-store\"], [1, \"categories\", 3, \"categories\", \"categoryChange\"], [1, \"products\", 3, \"user\", \"products\", \"categories\", \"productSelected\"], [\"class\", \"cart\", 3, \"user\", \"totalPrice\", \"cart\", \"removeItem\", 4, \"ngIf\"], [\"class\", \"product-form\", 4, \"ngIf\"], [1, \"cart\", 3, \"user\", \"totalPrice\", \"cart\", \"removeItem\"], [1, \"product-form\"]],\n  template: function StoreComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"div\", 1);\n      i0.ɵɵelementStart(2, \"app-categories\", 2);\n      i0.ɵɵlistener(\"categoryChange\", function StoreComponent_Template_app_categories_categoryChange_2_listener($event) {\n        return ctx.onCategorySelected($event);\n      });\n      i0.ɵɵpipe(3, \"async\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"app-products\", 3);\n      i0.ɵɵlistener(\"productSelected\", function StoreComponent_Template_app_products_productSelected_4_listener($event) {\n        return ctx.addToCart($event);\n      });\n      i0.ɵɵpipe(5, \"async\");\n      i0.ɵɵpipe(6, \"async\");\n      i0.ɵɵpipe(7, \"async\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(8, StoreComponent_app_cart_8_Template, 4, 9, \"app-cart\", 4);\n      i0.ɵɵpipe(9, \"async\");\n      i0.ɵɵtemplate(10, StoreComponent_app_product_form_10_Template, 1, 0, \"app-product-form\", 5);\n      i0.ɵɵpipe(11, \"async\");\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      let tmp_4_0;\n      let tmp_5_0;\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"categories\", i0.ɵɵpipeBind1(3, 6, ctx.categories$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"user\", i0.ɵɵpipeBind1(5, 8, ctx.user$))(\"products\", i0.ɵɵpipeBind1(6, 10, ctx.products$))(\"categories\", i0.ɵɵpipeBind1(7, 12, ctx.categories$));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = i0.ɵɵpipeBind1(9, 14, ctx.user$)) == null ? null : tmp_4_0.role) == \"user\");\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = i0.ɵɵpipeBind1(11, 16, ctx.user$)) == null ? null : tmp_5_0.role) == \"admin\");\n    }\n  },\n  directives: [i6.CategoriesComponent, i7.ProductsComponent, i8.NgIf, i9.CartComponent, i10.ProductFormComponent],\n  pipes: [i8.AsyncPipe],\n  styles: [\".container[_ngcontent-%COMP%] {\\n    display: grid;\\n    grid-template-columns: 20vw;\\n    grid-template-rows: auto;\\n    grid-template-areas: \\n      \\\"cart products \\\"\\n  }\\n\\n  .products[_ngcontent-%COMP%] {\\n    grid-area: products;\\n    background-color: fff;\\n  }\\n\\n  .categories[_ngcontent-%COMP%] {\\n    grid-area: products;\\n    background-color: rgb(255, 255, 255);\\n  }\\n\\n  .cart[_ngcontent-%COMP%] {\\n    grid-area: cart;\\n    background-color: #F7F7F7;\\n  }\\n\\n  .product-form[_ngcontent-%COMP%] {\\n    grid-area: cart;\\n    background-color: #F7F7F7;\\n  }\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0b3JlLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFDSSxhQUFhO0lBQ2IsMkJBQTJCO0lBQzNCLHdCQUF3QjtJQUN4Qjs7RUFFRjs7RUFFQTtJQUNFLG1CQUFtQjtJQUNuQixxQkFBcUI7RUFDdkI7O0VBQ0E7SUFDRSxtQkFBbUI7SUFDbkIsb0NBQW9DO0VBQ3RDOztFQUVBO0lBQ0UsZUFBZTtJQUNmLHlCQUF5QjtFQUMzQjs7RUFDQTtJQUNFLGVBQWU7SUFDZix5QkFBeUI7RUFDM0IiLCJmaWxlIjoic3RvcmUuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXIge1xuICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAyMHZ3O1xuICAgIGdyaWQtdGVtcGxhdGUtcm93czogYXV0bztcbiAgICBncmlkLXRlbXBsYXRlLWFyZWFzOiBcbiAgICAgIFwiY2FydCBwcm9kdWN0cyBcIlxuICB9XG5cbiAgLnByb2R1Y3RzIHtcbiAgICBncmlkLWFyZWE6IHByb2R1Y3RzO1xuICAgIGJhY2tncm91bmQtY29sb3I6IGZmZjtcbiAgfVxuICAuY2F0ZWdvcmllcyB7XG4gICAgZ3JpZC1hcmVhOiBwcm9kdWN0cztcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7XG4gIH1cblxuICAuY2FydCB7XG4gICAgZ3JpZC1hcmVhOiBjYXJ0O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNGN0Y3Rjc7XG4gIH1cbiAgLnByb2R1Y3QtZm9ybSB7XG4gICAgZ3JpZC1hcmVhOiBjYXJ0O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNGN0Y3Rjc7XG4gIH0iXX0= */\"]\n});","map":{"version":3,"sources":["/Users/neildahan/Desktop/JB/Project 4/Store/client/src/app/store/store.component.ts"],"names":["switchMap","take","i0","i1","i2","i3","i4","i5","i6","i7","i8","i9","i10","StoreComponent_app_cart_8_Template","rf","ctx","_r3","ɵɵgetCurrentView","ɵɵelementStart","ɵɵlistener","StoreComponent_app_cart_8_Template_app_cart_removeItem_0_listener","$event","ɵɵrestoreView","ctx_r2","ɵɵnextContext","removeFromCart","ɵɵpipe","ɵɵelementEnd","ctx_r0","ɵɵproperty","ɵɵpipeBind1","user$","totalPrice$","cart$","StoreComponent_app_product_form_10_Template","ɵɵelement","StoreComponent","constructor","categoriesService","productService","cartService","authService","activeRoute","products$","categories$","ngOnInit","getCategories","pipe","subscribe","currentCategory$","category","getProductsBySelectedCategory","id","onCategorySelected","setCurrentCategory","addToCart","product","_a","_b","console","log","cart","products","_product","find","p","quantity","updateCartItemQty","getCart","user","ɵfac","StoreComponent_Factory","t","ɵɵdirectiveInject","CategoriesService","ProductService","CartService","AuthenticationService","ActivatedRoute","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","StoreComponent_Template","StoreComponent_Template_app_categories_categoryChange_2_listener","StoreComponent_Template_app_products_productSelected_4_listener","ɵɵtemplate","tmp_4_0","tmp_5_0","ɵɵadvance","role","directives","CategoriesComponent","ProductsComponent","NgIf","CartComponent","ProductFormComponent","pipes","AsyncPipe","styles"],"mappings":"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","sourcesContent":["import { switchMap, take } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/categories.service\";\nimport * as i2 from \"../services/product.service\";\nimport * as i3 from \"../services/cart.service\";\nimport * as i4 from \"../services/authentication.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"./categories/categories.component\";\nimport * as i7 from \"./products/products.component\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"./cart/cart.component\";\nimport * as i10 from \"./product-form/product-form.component\";\nfunction StoreComponent_app_cart_8_Template(rf, ctx) { if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-cart\", 6);\n    i0.ɵɵlistener(\"removeItem\", function StoreComponent_app_cart_8_Template_app_cart_removeItem_0_listener($event) { i0.ɵɵrestoreView(_r3); const ctx_r2 = i0.ɵɵnextContext(); return ctx_r2.removeFromCart($event); });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd();\n} if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"user\", i0.ɵɵpipeBind1(1, 3, ctx_r0.user$))(\"totalPrice\", i0.ɵɵpipeBind1(2, 5, ctx_r0.totalPrice$))(\"cart\", i0.ɵɵpipeBind1(3, 7, ctx_r0.cart$));\n} }\nfunction StoreComponent_app_product_form_10_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelement(0, \"app-product-form\", 7);\n} }\nexport class StoreComponent {\n    constructor(categoriesService, productService, cartService, authService, activeRoute) {\n        this.categoriesService = categoriesService;\n        this.productService = productService;\n        this.cartService = cartService;\n        this.authService = authService;\n        this.activeRoute = activeRoute;\n        this.products$ = this.productService.products$;\n        this.categories$ = this.categoriesService.categories$;\n        this.cart$ = this.cartService.cart$;\n        this.totalPrice$ = this.cartService.totalPrice$;\n        this.user$ = this.authService.user$;\n    }\n    // ngOnDestroy(): void {\n    //   throw new Error('Method not implemented.');\n    // }\n    ngOnInit() {\n        this.categoriesService.getCategories().pipe(take(1)).subscribe();\n        this.categoriesService.currentCategory$\n            .pipe(switchMap((category) => {\n            return this.productService.getProductsBySelectedCategory(category === null || category === void 0 ? void 0 : category.id);\n        }))\n            .subscribe();\n    }\n    onCategorySelected(category) {\n        this.categoriesService.setCurrentCategory(category);\n    }\n    addToCart(product) {\n        var _a, _b;\n        console.log((_a = this.cartService.cart) === null || _a === void 0 ? void 0 : _a.products);\n        console.log(product);\n        const _product = (_b = this.cartService.cart) === null || _b === void 0 ? void 0 : _b.products.find(p => { var _a; return ((_a = p.product) === null || _a === void 0 ? void 0 : _a.id) == product.id; });\n        console.log(_product);\n        if (_product) {\n            _product.quantity += 1;\n            this.cartService.updateCartItemQty(_product).pipe(switchMap(() => { var _a; return this.cartService.getCart((_a = this.authService.user) === null || _a === void 0 ? void 0 : _a.id); })).subscribe();\n        }\n        else {\n            this.cartService\n                .addToCart(product)\n                .pipe(take(1), switchMap(() => { var _a; return this.cartService.getCart((_a = this.authService.user) === null || _a === void 0 ? void 0 : _a.id); }))\n                .subscribe();\n        }\n    }\n    removeFromCart(product) {\n        this.cartService.removeFromCart(product).pipe(take(1)).subscribe();\n    }\n}\nStoreComponent.ɵfac = function StoreComponent_Factory(t) { return new (t || StoreComponent)(i0.ɵɵdirectiveInject(i1.CategoriesService), i0.ɵɵdirectiveInject(i2.ProductService), i0.ɵɵdirectiveInject(i3.CartService), i0.ɵɵdirectiveInject(i4.AuthenticationService), i0.ɵɵdirectiveInject(i5.ActivatedRoute)); };\nStoreComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: StoreComponent, selectors: [[\"app-store\"]], decls: 12, vars: 18, consts: [[1, \"container\"], [1, \"main-store\"], [1, \"categories\", 3, \"categories\", \"categoryChange\"], [1, \"products\", 3, \"user\", \"products\", \"categories\", \"productSelected\"], [\"class\", \"cart\", 3, \"user\", \"totalPrice\", \"cart\", \"removeItem\", 4, \"ngIf\"], [\"class\", \"product-form\", 4, \"ngIf\"], [1, \"cart\", 3, \"user\", \"totalPrice\", \"cart\", \"removeItem\"], [1, \"product-form\"]], template: function StoreComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"app-categories\", 2);\n        i0.ɵɵlistener(\"categoryChange\", function StoreComponent_Template_app_categories_categoryChange_2_listener($event) { return ctx.onCategorySelected($event); });\n        i0.ɵɵpipe(3, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"app-products\", 3);\n        i0.ɵɵlistener(\"productSelected\", function StoreComponent_Template_app_products_productSelected_4_listener($event) { return ctx.addToCart($event); });\n        i0.ɵɵpipe(5, \"async\");\n        i0.ɵɵpipe(6, \"async\");\n        i0.ɵɵpipe(7, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(8, StoreComponent_app_cart_8_Template, 4, 9, \"app-cart\", 4);\n        i0.ɵɵpipe(9, \"async\");\n        i0.ɵɵtemplate(10, StoreComponent_app_product_form_10_Template, 1, 0, \"app-product-form\", 5);\n        i0.ɵɵpipe(11, \"async\");\n        i0.ɵɵelementEnd();\n    } if (rf & 2) {\n        let tmp_4_0;\n        let tmp_5_0;\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"categories\", i0.ɵɵpipeBind1(3, 6, ctx.categories$));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"user\", i0.ɵɵpipeBind1(5, 8, ctx.user$))(\"products\", i0.ɵɵpipeBind1(6, 10, ctx.products$))(\"categories\", i0.ɵɵpipeBind1(7, 12, ctx.categories$));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = i0.ɵɵpipeBind1(9, 14, ctx.user$)) == null ? null : tmp_4_0.role) == \"user\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = i0.ɵɵpipeBind1(11, 16, ctx.user$)) == null ? null : tmp_5_0.role) == \"admin\");\n    } }, directives: [i6.CategoriesComponent, i7.ProductsComponent, i8.NgIf, i9.CartComponent, i10.ProductFormComponent], pipes: [i8.AsyncPipe], styles: [\".container[_ngcontent-%COMP%] {\\n    display: grid;\\n    grid-template-columns: 20vw;\\n    grid-template-rows: auto;\\n    grid-template-areas: \\n      \\\"cart products \\\"\\n  }\\n\\n  .products[_ngcontent-%COMP%] {\\n    grid-area: products;\\n    background-color: fff;\\n  }\\n\\n  .categories[_ngcontent-%COMP%] {\\n    grid-area: products;\\n    background-color: rgb(255, 255, 255);\\n  }\\n\\n  .cart[_ngcontent-%COMP%] {\\n    grid-area: cart;\\n    background-color: #F7F7F7;\\n  }\\n\\n  .product-form[_ngcontent-%COMP%] {\\n    grid-area: cart;\\n    background-color: #F7F7F7;\\n  }\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0b3JlLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFDSSxhQUFhO0lBQ2IsMkJBQTJCO0lBQzNCLHdCQUF3QjtJQUN4Qjs7RUFFRjs7RUFFQTtJQUNFLG1CQUFtQjtJQUNuQixxQkFBcUI7RUFDdkI7O0VBQ0E7SUFDRSxtQkFBbUI7SUFDbkIsb0NBQW9DO0VBQ3RDOztFQUVBO0lBQ0UsZUFBZTtJQUNmLHlCQUF5QjtFQUMzQjs7RUFDQTtJQUNFLGVBQWU7SUFDZix5QkFBeUI7RUFDM0IiLCJmaWxlIjoic3RvcmUuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jb250YWluZXIge1xuICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAyMHZ3O1xuICAgIGdyaWQtdGVtcGxhdGUtcm93czogYXV0bztcbiAgICBncmlkLXRlbXBsYXRlLWFyZWFzOiBcbiAgICAgIFwiY2FydCBwcm9kdWN0cyBcIlxuICB9XG5cbiAgLnByb2R1Y3RzIHtcbiAgICBncmlkLWFyZWE6IHByb2R1Y3RzO1xuICAgIGJhY2tncm91bmQtY29sb3I6IGZmZjtcbiAgfVxuICAuY2F0ZWdvcmllcyB7XG4gICAgZ3JpZC1hcmVhOiBwcm9kdWN0cztcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjU1LCAyNTUsIDI1NSk7XG4gIH1cblxuICAuY2FydCB7XG4gICAgZ3JpZC1hcmVhOiBjYXJ0O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNGN0Y3Rjc7XG4gIH1cbiAgLnByb2R1Y3QtZm9ybSB7XG4gICAgZ3JpZC1hcmVhOiBjYXJ0O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNGN0Y3Rjc7XG4gIH0iXX0= */\"] });\n"]},"metadata":{},"sourceType":"module"}